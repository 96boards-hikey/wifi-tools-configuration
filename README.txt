In this document, I describe how firmwares are generated for WiFi (TI wl1835mod) modules on HiKey.

There are three 'firmware' files we need for wl1835 wifi:
a. wl1271-nvs.bin
b. wl18xx-fw-4.bin (from http://git.ti.com/wilink8-wlan/wl18xx_fw/trees/R8.6)
c. wl18xx-conf.bin

a and b are downloaded from ti website. as above. From their R8.6 version, which is their latest.
c is generated by myself. Since each board has their own special configurations, such as number of antennas. So, the reset of this email is just about how to do that.


I run configure-device.sh on HiKey board to generate 'wl18xx-conf.bin'. But configure-device.sh depends on lot of binaries runnables, such as wlconf. The procedure to get that done is described in: http://processors.wiki.ti.com/index.php/WL18xx_System_Build_Scripts#Building_R8.4_and_Above

After downloaded files, I modified build-utilities/setup-env (see setup-env.arm64.example in this repo). setting ARM64, setting toolchains, setting kernel src path, etc.
1) Then, ./sudo_build_wl18xx.sh update R8.6
2) Then, building modules one by one: ./sudo_build_wl18xx.sh <module>
3) When building ./sudo_build_wl18xx.sh libnl, I met an issue: it failed for arm64 and fell back to arm(32). I reported this issue to TI, but no solution yet. My workaround is: entering the libnl folder:
cd build-utilites/src/libnl
Then manually run,
$ ./configure --prefix=<your-downloading-root-dir>/build-utilites/fs  --host=aarch64-linux-gnu
$ make
$ sudo PATH=/home/docularxu/bin/toolchains/arm-tc/bin/:$PATH make install
4) Then, run $ ./sudo_build_wl18xx.sh utils
You also need to build these:
./sudo_build_wl18xx.sh openssl/ iw/ crda/ ... etc.
5) Install Firmware or Scripts
To install the firmware to the file system you would execute:
./sudo_build_wl18xx.sh firmware
To install the scripts to the file system you would execute:
./sudo_build_wl18xx.sh scripts

6) Finally, you should have everything ready in <your-downloading-root-dir>/build-utilites/fs, gzip it and copy to HiKey. After unzip, you can run on HiKey
# cd [fs]/usr/sbin/wlconf
# ./configure-device.sh
. For questions from the script, you should answer:
Are you using a TI module? [y/n] : y
What is the chip flavor? [1801/1805/1807/1831/1835/1837 or 0 for unknown] : 1835
How many 2.4GHz antennas are fitted? [1/2] : 1
Should SISO40 support be applied? [y/n] : n

The generated wl18xx-conf.bin will be put into /lib/firmware/ti-connectivity/. (if you are unsure, make a backup of the old file.) My version is uploaded here: https://github.com/96boards-hikey/wifi-tools-configuration
As reference, in the same URL, you can find the fs built by me. It is verified on HiKey on v4.4 kernel.

Let me know when you met any issue. <guodong.xu@linaro.org>
